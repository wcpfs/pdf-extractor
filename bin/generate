#!/usr/bin/env ruby
# encoding: utf-8

$LOAD_PATH << File.join(File.dirname(__FILE__), '..', 'lib')

require 'extractor'
require 'json'

if ARGV.length < 2
  STDERR.puts "Usage: generate <output dir> <pdf file> ..."
  exit 1
end


output_dir = ARGV.shift
extractor = Extractor.new
indexer = Indexer.new
ARGV.each do |pdf_file|
  new_asset_dir = extractor.extract_assets(pdf_file, output_dir)
  if new_asset_dir
    indexer.build_index(output_dir
  end
end
puts extractor.metadata.to_json
